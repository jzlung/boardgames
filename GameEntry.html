<!DOCTYPE html>
<html>
  <head>
    <title>Game Entry</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.1/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.1/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <style>

      body {
        background: #f5f5f5;
      }

      .crate {
        width: 80%;
        margin: auto;
      }

      .game-entry {
        font-family: Lato, Helvetica Neue;
      }

      .title {
        margin-bottom: 0;
      }

      .top-section {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .quick-info {
        margin: 10px;
        display: inline-block;
        align-self: flex-start;
      }

      .rating {
        display: inline-block;
        background: red;
        border-radius: 40px;
        padding: 20px;
        margin: 0 10px;
        font-weight: bold;
      }

      .num-reviews {
        font-size: 14px;
      }

      .categories {
        margin: 5px 10px;
      }

      .category {
        margin: 0 3px;
        text-decoration: none;
      }

      .btn.rate-me {
        background: red;
        border-radius: 5px;
        padding: 10px;
        display: inline-block;
      }

      .primary-stats {
        border: 2px black solid;
        padding: 10px;
        display: inline-block;
      }

      .primary-stats .image {
        width: 300px;
        display: block;
        border: 2px solid rgb(204, 204, 204);
        margin-bottom: 15px;
      }

      .entry .icon {
        width: 14px;
        height: 14px;
        margin-left: 10px;
        margin-right: 10px;
      }

      .entry .label {
        display: inline-block;
      }

      .critics {
        margin: 20px;
      }

      .critic {
        display: flex;
        align-items: center;
      }

      .critic-photo {
        width: 100px;
      }

      .critic-review {
        margin: 0 20px;
      }

    </style>

  </head>
  <body>
    <div class="crate"></div>
    <script type='text/babel'>

      const GameEntry = (props) => {
        const game = props.game;
        const rate = event => {
          prompt("Rating for " + game.name);
        };

        console.log(game);
        debugger;
        return (
          <div className="game-entry">
            <h1 className="title">{game.name}</h1>
            <div className="top-section">
              <div className="quick-info">
                <div className="rating">{Math.round(parseFloat(game.statistics.ratings.average) * 100) / 100}</div>
                <span className="num-reviews">
                  {game.statistics.ratings.usersrated} reviews
                </span>
                <div className="categories">
                  {game.categories.map(category => {
                      return (
                        <a href="#" className="category" >{category['#text']}</a>
                      );
                  })}
                </div>
              </div>
              <button className="btn rate-me" onClick={rate}>Rate this game!</button>
            </div>

            <div className="primary-stats">
              <img className="image" src={game.image} />
              <div className="entry rank">
                <img className="icon trophy" src="trophy.png"/>
                <div className="label">
                  BGG Rank #{game.statistics.ratings.ranks.rank[0]['@value']}
                </div>
              </div>
              <div className="entry num-players">
                <img className="icon meeple" src="meeple.jpg"/>
                <div className="label">
                  {game.minplayers}~{game.maxplayers} players
                </div>
              </div>
              <div className="entry playing-time">
                <img className="icon hourglass" src="hourglass.png"/>
                <div className="label">
                  {game.playingtime} minutes
                </div>
              </div>
              <div className="entry complexity">
                <img className="icon brain" src="brain.png"/>
                <div className="label">
                  Complexity: {Math.round(game.statistics.ratings.averageweight * 100) / 100}
                </div>
              </div>
            </div>

            <div className="showcase">

            </div>

            <div className="critics">
              <div className="critic">
                <img className="critic-photo" src="wil.jpg"/>
                <span className="critic-review">"Quite possibly, THE BEST game, I've ever tasted."</span>
              </div>
            </div>





          </div>
        );
      }

      const pandemicLegacy = {
        "@objectid": "161936",
        "name": "Pandemic Legacy: Season 1",
        "yearpublished": "2015",
        "minplayers": "2",
        "maxplayers": "4",
        "playingtime": "60",
        "minplaytime": "60",
        "maxplaytime": "60",
        "age": "13",
        "thumbnail": "//cf.geekdo-images.com/images/pic2452831_t.png",
        "image": "pandemiclegacy.png",
        "boardgamefamily": [
          {
            "@objectid": "24281",
            "#text": "Campaign Games"
          },
          {
            "@objectid": "25404",
            "#text": "Legacy"
          },
          {
            "@objectid": "3430",
            "#text": "Pandemic"
          }
        ],
        "boardgamedesigner": [
          {
            "@objectid": "442",
            "#text": "Rob Daviau"
          },
          {
            "@objectid": "378",
            "#text": "Matt Leacock"
          }
        ],
        "boardgamecategory": [
          {
            "@objectid": "1084",
            "#text": "Environmental"
          },
          {
            "@objectid": "2145",
            "#text": "Medical"
          }
        ],
        "boardgameartist": {
          "@objectid": "14057",
          "#text": "Chris Quilliams"
        },
        "categories": [
          {
            "@objectid": "5497",
            "#text": "Strategy"
          },
          // TODO: I added these manually
          {
            "@objectid": "999992",
            "#text": "Cooperative"
          },
          {
            "@objectid": "999991",
            "#text": "Legacy"
          }
        ],
        "boardgameimplementation": {
          "@objectid": "30549",
          "@inbound": "true",
          "#text": "Pandemic"
        },
        "statistics": {
          "@page": "1",
          "ratings": {
            "usersrated": "15037",
            "average": "8.65931",
            "bayesaverage": "8.46644",
            "ranks": {
              "rank": [
                {
                  "@type": "subtype",
                  "@id": "1",
                  "@name": "boardgame",
                  "@friendlyname": "Board Game Rank",
                  "@value": "1",
                  "@bayesaverage": "8.46644"
                },
                {
                  "@type": "family",
                  "@id": "5496",
                  "@name": "thematic",
                  "@friendlyname": "Thematic Rank",
                  "@value": "1",
                  "@bayesaverage": "8.48497"
                },
                {
                  "@type": "family",
                  "@id": "5497",
                  "@name": "strategygames",
                  "@friendlyname": "Strategy Game Rank",
                  "@value": "1",
                  "@bayesaverage": "8.46704"
                }
              ]
            },
            "stddev": "1.77846",
            "median": "0",
            "owned": "24966",
            "trading": "91",
            "wanting": "610",
            "wishing": "5513",
            "numcomments": "2645",
            "numweights": "573",
            "averageweight": "2.808"
          }
        },
        "boardgamemechanic": [
          {
            "@objectid": "2001",
            "#text": "Action Point Allowance System"
          },
          {
            "@objectid": "2023",
            "#text": "Co-operative Play"
          },
          {
            "@objectid": "2040",
            "#text": "Hand Management"
          },
          {
            "@objectid": "2078",
            "#text": "Point to Point Movement"
          },
          {
            "@objectid": "2004",
            "#text": "Set Collection"
          },
          {
            "@objectid": "2008",
            "#text": "Trading"
          },
          {
            "@objectid": "2015",
            "#text": "Variable Player Powers"
          }
        ],
        "boardgamepublisher": [
          {
            "@objectid": "538",
            "#text": "Z-Man Games"
          },
          {
            "@objectid": "15889",
            "#text": "Asterion Press"
          },
          {
            "@objectid": "2366",
            "#text": "Devir"
          },
          {
            "@objectid": "5657",
            "#text": "Filosofia \u00c9ditions"
          },
          {
            "@objectid": "8820",
            "#text": "G\u00e9m Klub Kft."
          },
          {
            "@objectid": "1391",
            "#text": "Hobby Japan"
          },
          {
            "@objectid": "15983",
            "#text": "Jolly Thinkers"
          },
          {
            "@objectid": "5812",
            "#text": "Lacerta"
          },
          {
            "@objectid": "9325",
            "#text": "Lifestyle Boardgames Ltd"
          },
          {
            "@objectid": "7992",
            "#text": "MINDOK"
          }
        ],
        "boardgamehonor": [
          {
            "@objectid": "34506",
            "#text": "2015 Golden Geek Best Innovative Board Game Nominee"
          },
          {
            "@objectid": "34781",
            "#text": "2015 Golden Geek Best Innovative Board Game Winner"
          },
          {
            "@objectid": "34510",
            "#text": "2015 Golden Geek Best Strategy Board Game Nominee"
          },
          {
            "@objectid": "34785",
            "#text": "2015 Golden Geek Best Strategy Board Game Winner"
          },
          {
            "@objectid": "34511",
            "#text": "2015 Golden Geek Best Thematic Board Game Nominee"
          },
          {
            "@objectid": "34786",
            "#text": "2015 Golden Geek Best Thematic Board Game Winner"
          },
          {
            "@objectid": "34500",
            "#text": "2015 Golden Geek Board Game of the Year Nominee"
          },
          {
            "@objectid": "34775",
            "#text": "2015 Golden Geek Board Game of the Year Winner"
          },
          {
            "@objectid": "37315",
            "#text": "2015 Meeples' Choice Nominee"
          },
          {
            "@objectid": "35436",
            "#text": "2016 As d'Or - Jeu de l'Ann\u00e9e Expert Nominee"
          },
          {
            "@objectid": "35437",
            "#text": "2016 As d'Or - Jeu de l'Ann\u00e9e Expert Winner"
          },
          {
            "@objectid": "36910",
            "#text": "2016 Diana Jones Award for Excellence in Gaming Nominee"
          },
          {
            "@objectid": "34820",
            "#text": "2016 Goblin Magnifico Nominee"
          },
          {
            "@objectid": "37769",
            "#text": "2016 International Gamers Award - General Strategy: Multi-player Nominee"
          },
          {
            "@objectid": "35994",
            "#text": "2016 Kennerspiel des Jahres Nominee"
          },
          {
            "@objectid": "36040",
            "#text": "2016 SXSW Tabletop Game of the Year Winner"
          }
        ],
        "description": "Pandemic Legacy is a co-operative campaign game, with an overarching story-arc played through 12-24 sessions, depending on how well your group does at the game. At the beginning, the game starts very similar to basic Pandemic, in which your team of disease-fighting specialists races against the clock to travel around the world, treating disease hotspots while researching cures for each of four plagues before they get out of hand.<br/><br/>During a player's turn, they have four actions available, with which they may travel around in the world in various ways (sometimes needing to discard a card), build structures like research stations, treat diseases (removing one cube from the board; if all cubes of a color have been removed, the disease has been eradicated), trade cards with other players, or find a cure for a disease (requiring five cards of the same color to be discarded while at a research station). Each player has a unique role with special abilities to help them at these actions.<br/><br/>After a player has taken their actions, they draw two cards. These cards can include epidemic cards, which will place new disease cubes on the board, and can lead to an outbreak, spreading disease cubes even further. Outbreaks additionally increase the panic level of a city, making that city more expensive to travel to.<br/><br/>Each month in the game, you have two chances to achieve that month's objectives. If you succeed, you win and immediately move on to the next month. If you fail, you have a second chance, with more funding for beneficial event cards.<br/><br/>During the campaign, new rules and components will be introduced. These will sometimes require you to permanently alter the components of the game; this includes writing on cards, ripping up cards, and placing permanent stickers on components. Your characters can gain new skills, or detrimental effects. A character can even be lost entirely, at which point it's no longer available for play.<br/><br/>"
      };

      function start() {
        // Comment all this out for local development
        // -----------------------------------------

        const API_URL = "http://localhost:3000"
        var xhr = new XMLHttpRequest();
        xhr.open('GET', API_URL + '/id/161936', true);
        xhr.withCredentials = true;
        xhr.responseType = 'json';

        xhr.onreadystatechange = function() {
          if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
            console.log(xhr.response);
            ReactDOM.render(
              <GameEntry game={xhr.response} />,
              document.querySelector('.crate'));
          }
        }

        xhr.onerror = function(err) {
          console.log("XHR ERROR:");
          console.log(xhr);
        };

        xhr.send();

      }
      start();

      // ------------------------------------------------------

      // ReactDOM.render(
      //   <GameEntry game={pandemicLegacy} />,
      //   document.querySelector('.crate'));

    </script>
  </body>
</html>
